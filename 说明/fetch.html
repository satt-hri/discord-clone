<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fetch例</title>
</head>
<script>


    function handleCommonResponse(response) {
        if (!response.ok) {
            throw new Error('エラーメッセージ');
        }
        return response.json();
    }


    function customFetch(url, options = {}) {
        const defaultHeaders = {
            'Content-Type': 'application/json',
            //ログイン結果の「csrf_token」
        };

        const mergedOptions = {
            ...options,
            headers: {
                ...defaultHeaders,
                ...options.headers,
            },
        };

        return fetch(url, mergedOptions)
            .then(handleCommonResponse)
            .catch(error => {
                console.error('エラー：', error);
                throw error;
            });
    }

    // URL
    const apiUrl = 'https://api.example.com/data';

    //get
    customFetch(apiUrl)
        .then(data => {
            console.log('成功：', data);
            // XXX
        })
        .catch(error => {
            console.error('異常:', error);
            // XXX
        });

    // POST
    const postData = {
        key: 'value',
    };

    customFetch(apiUrl, {
        method: 'POST',
        body: JSON.stringify(postData),
    })
        .then(data => {
            console.log('成功', data);
            // 
        })
        .catch(error => {
            console.error('異常', error);
            // 
        });

</script>

<body>

</body>

</html>